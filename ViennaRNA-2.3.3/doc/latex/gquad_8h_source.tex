\hypertarget{gquad_8h_source}{}\section{gquad.\+h}
\label{gquad_8h_source}\index{Vienna\+R\+N\+A/gquad.\+h@{Vienna\+R\+N\+A/gquad.\+h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef VIENNA\_RNA\_PACKAGE\_GQUAD\_H}
00002 \textcolor{preprocessor}{#define VIENNA\_RNA\_PACKAGE\_GQUAD\_H}
00003 
00004 \textcolor{preprocessor}{#include <\hyperlink{data__structures_8h}{ViennaRNA/data\_structures.h}>}
00005 \textcolor{preprocessor}{#include <\hyperlink{params_8h}{ViennaRNA/params.h}>}
00006 
00007 \textcolor{preprocessor}{#ifndef INLINE}
00008 \textcolor{preprocessor}{#ifdef \_\_GNUC\_\_}
00009 \textcolor{preprocessor}{# define INLINE inline}
00010 \textcolor{preprocessor}{#else}
00011 \textcolor{preprocessor}{# define INLINE}
00012 \textcolor{preprocessor}{#endif}
00013 \textcolor{preprocessor}{#endif}
00014 
00029 \textcolor{keywordtype}{int}         E\_gquad(\textcolor{keywordtype}{int} L,
00030                     \textcolor{keywordtype}{int} l[3],
00031                     \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00032 
00033 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} exp\_E\_gquad( \textcolor{keywordtype}{int} L,
00034                         \textcolor{keywordtype}{int} l[3],
00035                         \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00036 
00037 \textcolor{keywordtype}{int}         E\_gquad\_ali(\textcolor{keywordtype}{int} i,
00038                         \textcolor{keywordtype}{int} L,
00039                         \textcolor{keywordtype}{int} l[3],
00040                         \textcolor{keyword}{const} \textcolor{keywordtype}{short} **S,
00041                         \textcolor{keywordtype}{int} n\_seq,
00042                         \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00043 
00044 
00045 \textcolor{keywordtype}{void}        E\_gquad\_ali\_en( \textcolor{keywordtype}{int} i,
00046                             \textcolor{keywordtype}{int} L,
00047                             \textcolor{keywordtype}{int} l[3],
00048                             \textcolor{keyword}{const} \textcolor{keywordtype}{short} **S,
00049                             \textcolor{keywordtype}{int} n\_seq,
00050                             \textcolor{keywordtype}{int} en[2],
00051                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00052 
00069 \textcolor{keywordtype}{int}         *\hyperlink{group__gquads_ga392e45c9615aa123737671603fa4203c}{get\_gquad\_matrix}(\textcolor{keywordtype}{short} *S, \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00070 
00071 \textcolor{keywordtype}{int}         *get\_gquad\_ali\_matrix(\textcolor{keywordtype}{short} *S\_cons,
00072                                   \textcolor{keywordtype}{short} **S,
00073                                   \textcolor{keywordtype}{int} n\_seq,
00074                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00075 
00076 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}  *get\_gquad\_pf\_matrix( \textcolor{keywordtype}{short} *S,
00077                                   \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00078                                   \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00079 
00080 \textcolor{keywordtype}{int}         **get\_gquad\_L\_matrix( \textcolor{keywordtype}{short} *S,
00081                                   \textcolor{keywordtype}{int} start,
00082                                   \textcolor{keywordtype}{int} maxdist,
00083                                   \textcolor{keywordtype}{int} n,
00084                                   \textcolor{keywordtype}{int} **g,
00085                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00086 
00087 \textcolor{keywordtype}{void}        vrna\_gquad\_mx\_local\_update( \hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00088                                         \textcolor{keywordtype}{int} start);
00089 
00090 \textcolor{keywordtype}{void}        get\_gquad\_pattern\_mfe(\textcolor{keywordtype}{short} *S,
00091                                   \textcolor{keywordtype}{int} i,
00092                                   \textcolor{keywordtype}{int} j,
00093                                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P,
00094                                   \textcolor{keywordtype}{int} *L,
00095                                   \textcolor{keywordtype}{int} l[3]);
00096 
00097 \textcolor{keywordtype}{void}
00098 get\_gquad\_pattern\_exhaustive( \textcolor{keywordtype}{short} *S,
00099                               \textcolor{keywordtype}{int} i,
00100                               \textcolor{keywordtype}{int} j,
00101                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P,
00102                               \textcolor{keywordtype}{int} *L,
00103                               \textcolor{keywordtype}{int} *l,
00104                               \textcolor{keywordtype}{int} threshold);
00105 
00106 \textcolor{keywordtype}{void}        get\_gquad\_pattern\_pf( \textcolor{keywordtype}{short} *S,
00107                                   \textcolor{keywordtype}{int} i,
00108                                   \textcolor{keywordtype}{int} j,
00109                                   \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf,
00110                                   \textcolor{keywordtype}{int} *L,
00111                                   \textcolor{keywordtype}{int} l[3]);
00112 
00113 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_pr( \textcolor{keywordtype}{short} *S,
00114                                       \textcolor{keywordtype}{int} gi,
00115                                       \textcolor{keywordtype}{int} gj,
00116                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00117                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *probs,
00118                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00119                                       \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00120 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_pr\_max(\textcolor{keywordtype}{short} *S,
00121                                       \textcolor{keywordtype}{int} gi,
00122                                       \textcolor{keywordtype}{int} gj,
00123                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00124                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *probs,
00125                                       \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *scale,
00126                                       \textcolor{keywordtype}{int} *L,
00127                                       \textcolor{keywordtype}{int} l[3],
00128                                       \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf);
00129 
00130 \hyperlink{group__data__structures_structvrna__plist__s}{plist}       *get\_plist\_gquad\_from\_db( \textcolor{keyword}{const} \textcolor{keywordtype}{char} *structure,
00131                                       \textcolor{keywordtype}{float} \hyperlink{fold__vars_8h_ac98ec419070aee6831b44e5c700f090f}{pr});
00132 
00133 \textcolor{keywordtype}{int}         get\_gquad\_count(\textcolor{keywordtype}{short} *S,
00134                             \textcolor{keywordtype}{int} i,
00135                             \textcolor{keywordtype}{int} j);
00136 
00137 \textcolor{keywordtype}{int}         get\_gquad\_layer\_count(\textcolor{keywordtype}{short} *S,
00138                             \textcolor{keywordtype}{int} i,
00139                             \textcolor{keywordtype}{int} j);
00140 
00141 
00152 \textcolor{keywordtype}{int}         \hyperlink{group__gquads_gae41763215b9c64d2a7b67f0df8a28078}{parse\_gquad}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *struc, \textcolor{keywordtype}{int} *L, \textcolor{keywordtype}{int} l[3]);
00153 
00154 INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__gquads_ga220c41e8dbcee940ac975b8ce88e55c5}{backtrack\_GQuad\_IntLoop}(\textcolor{keywordtype}{int} c,
00155                                             \textcolor{keywordtype}{int} i,
00156                                             \textcolor{keywordtype}{int} j,
00157                                             \textcolor{keywordtype}{int} type,
00158                                             \textcolor{keywordtype}{short} *S,
00159                                             \textcolor{keywordtype}{int} *ggg,
00160                                             \textcolor{keywordtype}{int} *index,
00161                                             \textcolor{keywordtype}{int} *p,
00162                                             \textcolor{keywordtype}{int} *q,
00163                                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00164 
00165 INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__gquads_ga7b371308fa5a45c7ac353ef6ed1014de}{backtrack\_GQuad\_IntLoop\_L}(\textcolor{keywordtype}{int} c,
00166                                               \textcolor{keywordtype}{int} i,
00167                                               \textcolor{keywordtype}{int} j,
00168                                               \textcolor{keywordtype}{int} type,
00169                                               \textcolor{keywordtype}{short} *S,
00170                                               \textcolor{keywordtype}{int} **ggg,
00171                                               \textcolor{keywordtype}{int} maxdist,
00172                                               \textcolor{keywordtype}{int} *p,
00173                                               \textcolor{keywordtype}{int} *q,
00174                                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P);
00175 
00176 PRIVATE INLINE \textcolor{keywordtype}{int}
00177 vrna\_BT\_gquad\_mfe(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00178                   \textcolor{keywordtype}{int} i,
00179                   \textcolor{keywordtype}{int} j,
00180                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00181                   \textcolor{keywordtype}{int} *stack\_count);
00182 
00183 PRIVATE INLINE \textcolor{keywordtype}{int}
00184 vrna\_BT\_gquad\_int(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00185                   \textcolor{keywordtype}{int} i,
00186                   \textcolor{keywordtype}{int} j,
00187                   \textcolor{keywordtype}{int} en,
00188                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00189                   \textcolor{keywordtype}{int} *stack\_count);
00190 
00191 PRIVATE INLINE \textcolor{keywordtype}{int}
00192 vrna\_BT\_gquad\_mfe(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00193                   \textcolor{keywordtype}{int} i,
00194                   \textcolor{keywordtype}{int} j,
00195                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00196                   \textcolor{keywordtype}{int} *stack\_count)\{
00197 
00198   \textcolor{comment}{/*}
00199 \textcolor{comment}{    here we do some fancy stuff to backtrace the stacksize and linker lengths}
00200 \textcolor{comment}{    of the g-quadruplex that should reside within position i,j}
00201 \textcolor{comment}{  */}
00202   \textcolor{keywordtype}{short}         *S;
00203   \textcolor{keywordtype}{int}           l[3], L, a;
00204   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P;
00205 
00206   P = vc->\hyperlink{group__fold__compound_a19b8720c2c5321c1b97c830bd17566ea}{params};
00207   S = vc->sequence\_encoding2;
00208   L = -1;
00209 
00210   get\_gquad\_pattern\_mfe(S, i, j, P, &L, l);
00211 
00212   \textcolor{keywordflow}{if}(L != -1)\{
00213     \textcolor{comment}{/* fill the G's of the quadruplex into base\_pair2 */}
00214     \textcolor{keywordflow}{for}(a=0;a<L;a++)\{
00215       bp\_stack[++(*stack\_count)].i = i+a;
00216       bp\_stack[(*stack\_count)].j   = i+a;
00217       bp\_stack[++(*stack\_count)].i = i+L+l[0]+a;
00218       bp\_stack[(*stack\_count)].j   = i+L+l[0]+a;
00219       bp\_stack[++(*stack\_count)].i = i+L+l[0]+L+l[1]+a;
00220       bp\_stack[(*stack\_count)].j   = i+L+l[0]+L+l[1]+a;
00221       bp\_stack[++(*stack\_count)].i = i+L+l[0]+L+l[1]+L+l[2]+a;
00222       bp\_stack[(*stack\_count)].j   = i+L+l[0]+L+l[1]+L+l[2]+a;
00223     \}
00224     \textcolor{keywordflow}{return} 1;
00225   \} \textcolor{keywordflow}{else} \{
00226     \textcolor{keywordflow}{return} 0;
00227   \}
00228 \}
00229 
00230 PRIVATE INLINE \textcolor{keywordtype}{int}
00231 vrna\_BT\_gquad\_int(\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t} *vc,
00232                   \textcolor{keywordtype}{int} i,
00233                   \textcolor{keywordtype}{int} j,
00234                   \textcolor{keywordtype}{int} en,
00235                   \hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t} *bp\_stack,
00236                   \textcolor{keywordtype}{int} *stack\_count)\{
00237 
00238   \textcolor{keywordtype}{int}           energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, *idx, ij, p, q, maxl, minl, c0, l1, *rtype, *ggg;
00239   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} type;
00240   \textcolor{keywordtype}{char}          *ptype;
00241   \textcolor{keywordtype}{short}         si, sj, *S, *S1;
00242 
00243   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}  *P;
00244   \hyperlink{structvrna__md__s}{vrna\_md\_t}     *md;
00245 
00246   idx         = vc->\hyperlink{group__fold__compound_a5037235dee512efd85ca543780bbca1a}{jindx};
00247   ij          = idx[j] + i;
00248   P           = vc->\hyperlink{group__fold__compound_a19b8720c2c5321c1b97c830bd17566ea}{params};
00249   md          = &(P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details});
00250   ptype       = vc->\hyperlink{group__fold__compound_a3fbea559f1d1976b2d67c215cdeee0b2}{ptype};
00251   rtype       = &(md->\hyperlink{structvrna__md__s_ad082d0fea31e002b90cdfe5e6382f8b0}{rtype}[0]);
00252   type        = rtype[(\textcolor{keywordtype}{unsigned} char)ptype[ij]];
00253   S1          = vc->\hyperlink{group__fold__compound_a9934bdb695d35a3544285cbcc19f9763}{sequence\_encoding};
00254   S           = vc->sequence\_encoding2;
00255   dangles     = md->\hyperlink{structvrna__md__s_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00256   si          = S1[i + 1];
00257   sj          = S1[j - 1];
00258   ggg         = vc->\hyperlink{group__fold__compound_aca8be7bdc65bafe2172c6ee777f18568}{matrices}->\hyperlink{group__dp__matrices_a0b7b86a5c75c96eabb89eb53a13e7164}{ggg};
00259   energy      = 0;
00260 
00261   \textcolor{keywordflow}{if}(dangles == 2)
00262     energy += P->mismatchI[type][si][sj];
00263 
00264   \textcolor{keywordflow}{if}(type > 2)
00265     energy += P->TerminalAU;
00266 
00267   p = i + 1;
00268   \textcolor{keywordflow}{if}(S1[p] == 3)\{
00269     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00270       minl  = j - i + p - \hyperlink{energy__const_8h_ad1bd6eabac419670ddd3c9ed82145988}{MAXLOOP} - 2;
00271       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00272       minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00273       c0    = j - 3;
00274       maxl  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00275       maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00276       \textcolor{keywordflow}{for}(q = minl; q < maxl; q++)\{
00277         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00278         \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[j - q - 1])\{
00279           \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00280         \}
00281       \}
00282     \}
00283   \}
00284 
00285   \textcolor{keywordflow}{for}(p = i + 2;
00286       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00287       p++)\{
00288     l1    = p - i - 1;
00289     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00290     \textcolor{keywordflow}{if}(S1[p] != 3) \textcolor{keywordflow}{continue};
00291     minl  = j - i + p - MAXLOOP - 2;
00292     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00293     minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00294     c0    = j - 1;
00295     maxl  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00296     maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00297     \textcolor{keywordflow}{for}(q = minl; q < maxl; q++)\{
00298       \textcolor{keywordflow}{if}(S1[q] != 3) \textcolor{keywordflow}{continue};
00299       \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[l1 + j - q - 1])\{
00300         \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00301       \}
00302     \}
00303   \}
00304 
00305   q = j - 1;
00306   \textcolor{keywordflow}{if}(S1[q] == 3)
00307     \textcolor{keywordflow}{for}(p = i + 4;
00308         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00309         p++)\{
00310       l1    = p - i - 1;
00311       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00312       \textcolor{keywordflow}{if}(S1[p] != 3) \textcolor{keywordflow}{continue};
00313       \textcolor{keywordflow}{if}(en == energy + ggg[idx[q] + p] + P->internal\_loop[l1])\{
00314         \textcolor{keywordflow}{return} vrna\_BT\_gquad\_mfe(vc, p, q, bp\_stack, stack\_count);
00315       \}
00316     \}
00317 
00318   \textcolor{keywordflow}{return} 0;
00319 \}
00320 
\hypertarget{gquad_8h_source.tex_l00338}{}\hyperlink{group__gquads_ga220c41e8dbcee940ac975b8ce88e55c5}{00338} INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__gquads_ga220c41e8dbcee940ac975b8ce88e55c5}{backtrack\_GQuad\_IntLoop}(\textcolor{keywordtype}{int} c,
00339                                             \textcolor{keywordtype}{int} i,
00340                                             \textcolor{keywordtype}{int} j,
00341                                             \textcolor{keywordtype}{int} type,
00342                                             \textcolor{keywordtype}{short} *S,
00343                                             \textcolor{keywordtype}{int} *ggg,
00344                                             \textcolor{keywordtype}{int} *index,
00345                                             \textcolor{keywordtype}{int} *p,
00346                                             \textcolor{keywordtype}{int} *q,
00347                                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00348 
00349   \textcolor{keywordtype}{int} energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1;
00350   \textcolor{keywordtype}{short} si, sj;
00351 
00352   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{structvrna__md__s_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00353   si      = S[i + 1];
00354   sj      = S[j - 1];
00355   energy  = 0;
00356 
00357   \textcolor{keywordflow}{if}(dangles == 2)
00358     energy += P->mismatchI[type][si][sj];
00359 
00360   \textcolor{keywordflow}{if}(type > 2)
00361     energy += P->TerminalAU;
00362 
00363   k = i + 1;
00364   \textcolor{keywordflow}{if}(S[k] == 3)\{
00365     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00366       minl  = j - i + k - MAXLOOP - 2;
00367       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00368       minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00369       c0    = j - 3;
00370       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00371       maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00372       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00373         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00374         \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[j - l - 1])\{
00375           *p = k; *q = l;
00376           \textcolor{keywordflow}{return} 1;
00377         \}
00378       \}
00379     \}
00380   \}
00381 
00382   \textcolor{keywordflow}{for}(k = i + 2;
00383       k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00384       k++)\{
00385     l1    = k - i - 1;
00386     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00387     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00388     minl  = j - i + k - MAXLOOP - 2;
00389     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00390     minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00391     c0    = j - 1;
00392     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00393     maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00394     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00395       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00396       \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[l1 + j - l - 1])\{
00397         *p = k; *q = l;
00398         \textcolor{keywordflow}{return} 1;
00399       \}
00400     \}
00401   \}
00402 
00403   l = j - 1;
00404   \textcolor{keywordflow}{if}(S[l] == 3)
00405     \textcolor{keywordflow}{for}(k = i + 4;
00406         k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00407         k++)\{
00408       l1    = k - i - 1;
00409       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00410       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00411       \textcolor{keywordflow}{if}(c == energy + ggg[index[l] + k] + P->internal\_loop[l1])\{
00412         *p = k; *q = l;
00413         \textcolor{keywordflow}{return} 1;
00414       \}
00415     \}
00416 
00417   \textcolor{keywordflow}{return} 0;
00418 \}
00419 
\hypertarget{gquad_8h_source.tex_l00436}{}\hyperlink{group__gquads_ga7b371308fa5a45c7ac353ef6ed1014de}{00436} INLINE  PRIVATE \textcolor{keywordtype}{int} \hyperlink{group__gquads_ga7b371308fa5a45c7ac353ef6ed1014de}{backtrack\_GQuad\_IntLoop\_L}(\textcolor{keywordtype}{int} c,
00437                                               \textcolor{keywordtype}{int} i,
00438                                               \textcolor{keywordtype}{int} j,
00439                                               \textcolor{keywordtype}{int} type,
00440                                               \textcolor{keywordtype}{short} *S,
00441                                               \textcolor{keywordtype}{int} **ggg,
00442                                               \textcolor{keywordtype}{int} maxdist,
00443                                               \textcolor{keywordtype}{int} *p,
00444                                               \textcolor{keywordtype}{int} *q,
00445                                               \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00446 
00447   \textcolor{keywordtype}{int} energy, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, k, l, maxl, minl, c0, l1;
00448   \textcolor{keywordtype}{short} si, sj;
00449 
00450   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{structvrna__md__s_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00451   si      = S[i + 1];
00452   sj      = S[j - 1];
00453   energy  = 0;
00454 
00455   \textcolor{keywordflow}{if}(dangles == 2)
00456     energy += P->mismatchI[type][si][sj];
00457 
00458   \textcolor{keywordflow}{if}(type > 2)
00459     energy += P->TerminalAU;
00460 
00461   k = i + 1;
00462   \textcolor{keywordflow}{if}(S[k] == 3)\{
00463     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00464       minl  = j - i + k - MAXLOOP - 2;
00465       c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00466       minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00467       c0    = j - 3;
00468       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00469       maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00470       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00471         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00472         \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[j - l - 1])\{
00473           *p = k; *q = l;
00474           \textcolor{keywordflow}{return} 1;
00475         \}
00476       \}
00477     \}
00478   \}
00479 
00480   \textcolor{keywordflow}{for}(k = i + 2;
00481       k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00482       k++)\{
00483     l1    = k - i - 1;
00484     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00485     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00486     minl  = j - i + k - MAXLOOP - 2;
00487     c0    = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00488     minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minl);
00489     c0    = j - 1;
00490     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00491     maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxl);
00492     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00493       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00494       \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[l1 + j - l - 1])\{
00495         *p = k; *q = l;
00496         \textcolor{keywordflow}{return} 1;
00497       \}
00498     \}
00499   \}
00500 
00501   l = j - 1;
00502   \textcolor{keywordflow}{if}(S[l] == 3)
00503     \textcolor{keywordflow}{for}(k = i + 4;
00504         k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00505         k++)\{
00506       l1    = k - i - 1;
00507       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00508       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00509       \textcolor{keywordflow}{if}(c == energy + ggg[k][l - k] + P->internal\_loop[l1])\{
00510         *p = k; *q = l;
00511         \textcolor{keywordflow}{return} 1;
00512       \}
00513     \}
00514 
00515   \textcolor{keywordflow}{return} 0;
00516 \}
00517 
00518 PRIVATE INLINE
00519 \textcolor{keywordtype}{int}
00520 E\_GQuad\_IntLoop(\textcolor{keywordtype}{int} i,
00521                 \textcolor{keywordtype}{int} j,
00522                 \textcolor{keywordtype}{int} type,
00523                 \textcolor{keywordtype}{short} *S,
00524                 \textcolor{keywordtype}{int} *ggg,
00525                 \textcolor{keywordtype}{int} *index,
00526                 \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00527 
00528   \textcolor{keywordtype}{int} energy, ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00529   \textcolor{keywordtype}{short} si, sj;
00530 
00531   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{structvrna__md__s_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00532   si      = S[i + 1];
00533   sj      = S[j - 1];
00534   energy  = 0;
00535 
00536   \textcolor{keywordflow}{if}(dangles == 2)
00537     energy += P->mismatchI[type][si][sj];
00538 
00539   \textcolor{keywordflow}{if}(type > 2)
00540     energy += P->TerminalAU;
00541 
00542   ge = \hyperlink{energy__const_8h_a12c2040f25d8e3a7b9e1c2024c618cb6}{INF};
00543 
00544   p = i + 1;
00545   \textcolor{keywordflow}{if}(S[p] == 3)\{
00546     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00547       minq  = j - i + p - MAXLOOP - 2;
00548       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00549       minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00550       c0    = j - 3;
00551       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00552       maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00553       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00554         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00555         c0  = energy + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00556         ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00557       \}
00558     \}
00559   \}
00560 
00561   \textcolor{keywordflow}{for}(p = i + 2;
00562       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00563       p++)\{
00564     l1    = p - i - 1;
00565     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00566     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00567     minq  = j - i + p - MAXLOOP - 2;
00568     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00569     minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00570     c0    = j - 1;
00571     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00572     maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00573     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00574       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00575       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00576       ge   = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00577     \}
00578   \}
00579 
00580   q = j - 1;
00581   \textcolor{keywordflow}{if}(S[q] == 3)
00582     \textcolor{keywordflow}{for}(p = i + 4;
00583         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00584         p++)\{
00585       l1    = p - i - 1;
00586       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00587       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00588       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1];
00589       ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00590     \}
00591 
00592 \textcolor{preprocessor}{#if 0}
00593   \textcolor{comment}{/* here comes the additional stuff for the odd dangle models */}
00594   \textcolor{keywordflow}{if}(dangles % 1)\{
00595     en1 = energy + P->dangle5[type][si];
00596     en2 = energy + P->dangle5[type][sj];
00597     en3 = energy + P->mismatchI[type][si][sj];
00598 
00599     \textcolor{comment}{/* first case with 5' dangle (i.e. j-1) onto enclosing pair */}
00600     p = i + 1;
00601     \textcolor{keywordflow}{if}(S[p] == 3)\{
00602       \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00603         minq  = j - i + p - MAXLOOP - 2;
00604         c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00605         minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00606         c0    = j - 4;
00607         maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00608         maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00609         \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00610           \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00611           c0  = en1 + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00612           ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00613         \}
00614       \}
00615     \}
00616 
00617     \textcolor{keywordflow}{for}(p = i + 2; p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; p++)\{
00618       l1    = p - i - 1;
00619       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00620       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00621       minq  = j - i + p - MAXLOOP - 2;
00622       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00623       minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00624       c0    = j - 2;
00625       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00626       maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00627       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00628         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00629         c0  = en1 + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00630         ge   = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00631       \}
00632     \}
00633 
00634     q = j - 2;
00635     \textcolor{keywordflow}{if}(S[q] == 3)
00636       \textcolor{keywordflow}{for}(p = i + 4; p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; p++)\{
00637         l1    = p - i - 1;
00638         \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00639         \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00640         c0  = en1 + ggg[index[q] + p] + P->internal\_loop[l1 + 1];
00641         ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00642       \}
00643 
00644     \textcolor{comment}{/* second case with 3' dangle (i.e. i+1) onto enclosing pair */}
00645 
00646   \}
00647 \textcolor{preprocessor}{#endif}
00648   \textcolor{keywordflow}{return} ge;
00649 \}
00650 
00651 PRIVATE INLINE
00652 \textcolor{keywordtype}{int} *
00653 E\_GQuad\_IntLoop\_exhaustive( \textcolor{keywordtype}{int} i,
00654                             \textcolor{keywordtype}{int} j,
00655                             \textcolor{keywordtype}{int} **p\_p,
00656                             \textcolor{keywordtype}{int} **q\_p,
00657                             \textcolor{keywordtype}{int} type,
00658                             \textcolor{keywordtype}{short} *S,
00659                             \textcolor{keywordtype}{int} *ggg,
00660                             \textcolor{keywordtype}{int} threshold,
00661                             \textcolor{keywordtype}{int} *index,
00662                             \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00663 
00664   \textcolor{keywordtype}{int} energy, *ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00665   \textcolor{keywordtype}{short} si, sj;
00666   \textcolor{keywordtype}{int} cnt = 0;
00667 
00668   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{structvrna__md__s_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00669   si      = S[i + 1];
00670   sj      = S[j - 1];
00671   energy  = 0;
00672 
00673   \textcolor{keywordflow}{if}(dangles == 2)
00674     energy += P->mismatchI[type][si][sj];
00675 
00676   \textcolor{keywordflow}{if}(type > 2)
00677     energy += P->TerminalAU;
00678 
00679   \textcolor{comment}{/* guess how many gquads are possible in interval [i+1,j-1] */}
00680   *p\_p  = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00681   *q\_p  = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00682   ge    = (\textcolor{keywordtype}{int} *)\hyperlink{group__utils_gaf37a0979367c977edfb9da6614eebe99}{vrna\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * 256);
00683 
00684   p = i + 1;
00685   \textcolor{keywordflow}{if}(S[p] == 3)\{
00686     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00687       minq  = j - i + p - MAXLOOP - 2;
00688       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00689       minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00690       c0    = j - 3;
00691       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00692       maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00693       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00694         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00695         c0  = energy + ggg[index[q] + p] + P->internal\_loop[j - q - 1];
00696         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00697           ge[cnt]       = energy + P->internal\_loop[j - q - 1];
00698           (*p\_p)[cnt]   = p;
00699           (*q\_p)[cnt++] = q;
00700         \}
00701       \}
00702     \}
00703   \}
00704 
00705   \textcolor{keywordflow}{for}(p = i + 2;
00706       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00707       p++)\{
00708     l1    = p - i - 1;
00709     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00710     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00711     minq  = j - i + p - MAXLOOP - 2;
00712     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00713     minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00714     c0    = j - 1;
00715     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00716     maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00717     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00718       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00719       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1 + j - q - 1];
00720         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00721           ge[cnt]       = energy + P->internal\_loop[l1 + j - q - 1];
00722           (*p\_p)[cnt]   = p;
00723           (*q\_p)[cnt++] = q;
00724         \}
00725     \}
00726   \}
00727 
00728   q = j - 1;
00729   \textcolor{keywordflow}{if}(S[q] == 3)
00730     \textcolor{keywordflow}{for}(p = i + 4;
00731         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00732         p++)\{
00733       l1    = p - i - 1;
00734       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00735       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00736       c0  = energy + ggg[index[q] + p] + P->internal\_loop[l1];
00737         \textcolor{keywordflow}{if}(c0 <= threshold)\{
00738           ge[cnt]       = energy + P->internal\_loop[l1];
00739           (*p\_p)[cnt]   = p;
00740           (*q\_p)[cnt++] = q;
00741         \}
00742     \}
00743 
00744 
00745   (*p\_p)[cnt] = -1;
00746 
00747   \textcolor{keywordflow}{return} ge;
00748 \}
00749 
00750 PRIVATE INLINE
00751 \textcolor{keywordtype}{int}
00752 E\_GQuad\_IntLoop\_L(\textcolor{keywordtype}{int} i,
00753                   \textcolor{keywordtype}{int} j,
00754                   \textcolor{keywordtype}{int} type,
00755                   \textcolor{keywordtype}{short} *S,
00756                   \textcolor{keywordtype}{int} **ggg,
00757                   \textcolor{keywordtype}{int} maxdist,
00758                   \hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t} *P)\{
00759 
00760   \textcolor{keywordtype}{int} energy, ge, \hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}, p, q, l1, minq, maxq, c0;
00761   \textcolor{keywordtype}{short} si, sj;
00762 
00763   dangles = P->\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}.\hyperlink{structvrna__md__s_adcda4ff2ea77748ae0e8700288282efc}{dangles};
00764   si      = S[i + 1];
00765   sj      = S[j - 1];
00766   energy  = 0;
00767 
00768   \textcolor{keywordflow}{if}(dangles == 2)
00769     energy += P->mismatchI[type][si][sj];
00770 
00771   \textcolor{keywordflow}{if}(type > 2)
00772     energy += P->TerminalAU;
00773 
00774   ge = \hyperlink{energy__const_8h_a12c2040f25d8e3a7b9e1c2024c618cb6}{INF};
00775 
00776   p = i + 1;
00777   \textcolor{keywordflow}{if}(S[p] == 3)\{
00778     \textcolor{keywordflow}{if}(p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00779       minq  = j - i + p - MAXLOOP - 2;
00780       c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00781       minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00782       c0    = j - 3;
00783       maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00784       maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00785       \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00786         \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00787         c0  = energy + ggg[p][q-p] + P->internal\_loop[j - q - 1];
00788         ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00789       \}
00790     \}
00791   \}
00792 
00793   \textcolor{keywordflow}{for}(p = i + 2;
00794       p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00795       p++)\{
00796     l1    = p - i - 1;
00797     \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00798     \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00799     minq  = j - i + p - MAXLOOP - 2;
00800     c0    = p + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00801     minq  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(c0, minq);
00802     c0    = j - 1;
00803     maxq  = p + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00804     maxq  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(c0, maxq);
00805     \textcolor{keywordflow}{for}(q = minq; q < maxq; q++)\{
00806       \textcolor{keywordflow}{if}(S[q] != 3) \textcolor{keywordflow}{continue};
00807       c0  = energy + ggg[p][q - p] + P->internal\_loop[l1 + j - q - 1];
00808       ge   = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00809     \}
00810   \}
00811 
00812   q = j - 1;
00813   \textcolor{keywordflow}{if}(S[q] == 3)
00814     \textcolor{keywordflow}{for}(p = i + 4;
00815         p < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00816         p++)\{
00817       l1    = p - i - 1;
00818       \textcolor{keywordflow}{if}(l1>MAXLOOP) \textcolor{keywordflow}{break};
00819       \textcolor{keywordflow}{if}(S[p] != 3) \textcolor{keywordflow}{continue};
00820       c0  = energy + ggg[p][q - p] + P->internal\_loop[l1];
00821       ge  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(ge, c0);
00822     \}
00823 
00824   \textcolor{keywordflow}{return} ge;
00825 \}
00826 
00827 PRIVATE INLINE
00828 \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}
00829 exp\_E\_GQuad\_IntLoop(\textcolor{keywordtype}{int} i,
00830                     \textcolor{keywordtype}{int} j,
00831                     \textcolor{keywordtype}{int} type,
00832                     \textcolor{keywordtype}{short} *S,
00833                     \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL} *G,
00834                     \textcolor{keywordtype}{int} *index,
00835                     \hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t} *pf)\{
00836 
00837   \textcolor{keywordtype}{int}         k, l, minl, maxl, u, r;
00838   \hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}  q, qe;
00839   \textcolor{keywordtype}{double}      *expintern;
00840   \textcolor{keywordtype}{short}       si, sj;
00841 
00842   q         = 0;
00843   si        = S[i + 1];
00844   sj        = S[j - 1];
00845   qe        = (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})pf->expmismatchI[type][si][sj];
00846   expintern = pf->expinternal;
00847 
00848   \textcolor{keywordflow}{if}(type > 2)
00849     qe *= (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})pf->expTermAU;
00850 
00851   k = i + 1;
00852   \textcolor{keywordflow}{if}(S[k] == 3)\{
00853     \textcolor{keywordflow}{if}(k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE)\{
00854       minl  = j - i + k - MAXLOOP - 2;
00855       u     = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00856       minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(u, minl);
00857       u     = j - 3;
00858       maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00859       maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(u, maxl);
00860       \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00861         \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00862         \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00863         q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[j - l - 1];
00864       \}
00865     \}
00866   \}
00867 
00868 
00869   \textcolor{keywordflow}{for}(k = i + 2;
00870       k <= j - VRNA\_GQUAD\_MIN\_BOX\_SIZE;
00871       k++)\{
00872     u = k - i - 1;
00873     \textcolor{keywordflow}{if}(u > MAXLOOP) \textcolor{keywordflow}{break};
00874     \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00875     minl  = j - i + k - MAXLOOP - 2;
00876     r     = k + VRNA\_GQUAD\_MIN\_BOX\_SIZE - 1;
00877     minl  = \hyperlink{group__utils_gadd91367918fadbc8d585940d6206d6d2}{MAX2}(r, minl);
00878     maxl  = k + VRNA\_GQUAD\_MAX\_BOX\_SIZE + 1;
00879     r     = j - 1;
00880     maxl  = \hyperlink{group__utils_ga2dd4a927a7f937f43a90c144d79107d8}{MIN2}(r, maxl);
00881     \textcolor{keywordflow}{for}(l = minl; l < maxl; l++)\{
00882       \textcolor{keywordflow}{if}(S[l] != 3) \textcolor{keywordflow}{continue};
00883       \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00884       q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[u + j - l - 1];
00885     \}
00886   \}
00887 
00888   l = j - 1;
00889   \textcolor{keywordflow}{if}(S[l] == 3)
00890     \textcolor{keywordflow}{for}(k = i + 4; k < j - VRNA\_GQUAD\_MIN\_BOX\_SIZE; k++)\{
00891       u    = k - i - 1;
00892       \textcolor{keywordflow}{if}(u>MAXLOOP) \textcolor{keywordflow}{break};
00893       \textcolor{keywordflow}{if}(S[k] != 3) \textcolor{keywordflow}{continue};
00894       \textcolor{keywordflow}{if}(G[index[k]-l] == 0.) \textcolor{keywordflow}{continue};
00895       q += qe * G[index[k]-l] * (\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL})expintern[u];
00896     \}
00897 
00898   \textcolor{keywordflow}{return} q;
00899 \}
00900 
00906 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
